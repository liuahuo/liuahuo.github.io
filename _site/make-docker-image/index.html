<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.0.0 --> <title>制作docker image - I’m Amanda</title> <meta property="og:title" content="制作docker image" /> <meta name="description" content="1.使用febootstrap制作base image" /> <meta property="og:description" content="1.使用febootstrap制作base image" /> <link rel="canonical" href="http://localhost:4000/make-docker-image/" /> <meta property="og:url" content="http://localhost:4000/make-docker-image/" /> <meta property="og:site_name" content="I’m Amanda" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2016-07-11T00:00:00+08:00" /> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BlogPosting", "headline": "制作docker image", "datePublished": "2016-07-11T00:00:00+08:00", "description": "1.使用febootstrap制作base image", "url": "http://localhost:4000/make-docker-image/" } </script> <!-- End Jekyll SEO tag --> <link href="https://fonts.googleapis.com/css?family=Alfa+Slab+One|Source+Serif+Pro" rel="stylesheet"> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://localhost:4000/make-docker-image/"> <link rel="alternate" type="application/rss+xml" title="I'm Amanda" href="http://localhost:4000/feed.xml"> </head> <body> <div class="wrapper"> <div class="color-bars-header"><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div></div> <style>.color-bars-header{font-size:0}.cor-head{width:12.5%;height:8px;display:inline-block}.colr-1{background-color:#98C1D9}.colr-2{background-color:#F3DE8A}.colr-3{background-color:#A7D3A6}.colr-4{background-color:#EB9486}@media screen and (max-width: 800px){.color-bars-header{margin: 0 -15px}}</style> <header class="site-header"> <div class="wrapper"> <a href="/"><h1 class="site-title">I'm Amanda</h1></a> <nav class="site-nav"> <a href="https://github.com/liuahuo" class="nav-link">首页</a> <a href="/about/" class="nav-link">归档</a> <a href="/contact/" class="nav-link">关于</a> </nav> </div> </header> </div> <div class="page-content"> <div class="wrapper"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">制作docker image</h1> <p class="post-meta"><time datetime="2016-07-11T00:00:00+08:00" itemprop="datePublished">Jul 11, 2016</time></p> </header> <div class="post-content" itemprop="articleBody"> <h3 id="febootstrapbase-image">1.使用febootstrap制作base image</h3> <ul> <li>制作镜像目录</li> </ul> <p>在Docker入门（http://blog.csdn.net/woshiluahuo/article/details/51838451）中，我们讲到base image，现在要使用febootstrap工具制作base image：</p> <p>febootstrap -i bash -i wget -i yum -i iputils -i iproute -i man -i vim -i openssh-server -i openssh-clients -i tar -i gzip centos7 centos7-image http://mirrors.aliyun.com/centos/7/os/x86_64/</p> <ul> <li>1.-i 表示需要安装的package，例如上面的语句：想要base image中安装：bash、wget、yum、iputils、iproute 、man、vim 、openssh-server、openssh-clients、tar 、gzip</li> </ul> <p>这个可以根据自己的需要进行安装，其中openssh-server、openssh-clients这2个包是为了后面ssh登录准备的。</p> <ul> <li> <p>2.centos7 是操作系统版本</p> </li> <li> <p>3.centos7-image 是目录（base image想放在服务器的位置）</p> </li> <li> <p>4.源地址，我选择的是阿里云的，也可以使用其他源地址</p> </li> </ul> <p>执行完上面的语句会生成centos7-image文件目录，包含以下文件：</p> <p><img src="/images/make-docker-image/directory.png" alt="directory" /></p> <p>root目录下是空的，如果这时制作出来的镜像使用ssh登录，会直接进入根目录下，而一般镜像都是进入root目录下的， <br /> 所以执行：cd centos7-image &amp;&amp; cp etc/skel/.bash* root/语句，将.bash_logout .bash_profile .bashrc这三个文件拷贝至root文件夹下。</p> <ul> <li>生成base image</li> </ul> <p>执行：cd centos7-image &amp;&amp; tar -c .|docker import - centos7-base 语句，将centos7-image目录下内容打包并将打包内容创建为一个docker镜像。 查看镜像，发现镜像中有一个名为：centos7-base的镜像</p> <p><img src="/images/make-docker-image/base-image.png" alt="base image" /></p> <p>此时，我们已经可以将centos7-base镜像运行在docker的container中了。</p> <p><img src="/images/make-docker-image/run-base-image.png" alt="run base image" /></p> <h3 id="dockfilesshimage">2.使用Dockfile制作可以使用ssh登录的image</h3> <ul> <li>dockfile</li> </ul> <p>以我们刚刚制作的centos7-base作为base image，使用dockfile制作可以使用ssh登录的image。创建名为：Dockfile的文件，内容如下：<br /> #Dockerfile <br /> FROM centos7-base #将centos7-base作为base image，类似继承的概念，制作出的新的image具有base image的功能<br /> MAINTAINER ahuo<br /> RUN ssh-keygen -q -N “” -t dsa -f /etc/ssh/ssh_host_dsa_key<br /> RUN ssh-keygen -q -N “” -t rsa -f /etc/ssh/ssh_host_rsh_key<br /> RUN sed -ri ‘s/session required pam_loginuid.so/#session required pam_loginuid.so/g’ /etc/pam.d/sshd<br /> RUN mkdir -p /root/.ssh &amp;&amp; chown root.root /root &amp;&amp; chmod 700 /root/.ssh<br /> #上面几行都是配置ssh登录目录和登录验证的，而ssh的安装时在base image centos7-base中完成的(-i openssh-server -i openssh-client)<br /> EXPOSE 22 #开端口<br /> RUN echo ‘root:redhat’ | chpasswd #重置root密码为redhat<br /> RUN yum install tar gzip gcc vim wget -y<br /> ENV LANG en_US.UTF-8<br /> ENV LC_ALL en_US.UTF-8<br /> CMD /usr/sbin/sshd -D<br /> #End</p> </div> </article> <div id="disqus_thread"></div> <script defer> (function() { var d = document, s = d.createElement('script'); s.src = '//webjeda-demo.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> <div class="wrapper"> <footer class="site-footer"> <div class="wrapper"> </div> </footer> <div class="color-bars-header"><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div></div> </div> <!-- Google Analytics Tracking code --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-83979019-1', 'auto'); ga('send', 'pageview'); </script> </body> </html>

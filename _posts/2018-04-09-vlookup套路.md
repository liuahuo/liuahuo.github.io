---
layout: post
title: vlookup的套路
category: 数据分析
---

### vlookup 常见错误类型
\#NAME？ 函数名称  
出现该错误，通常是函数名称中的字符错了、漏了、多了、顺序弄错了，或者函数参数中多了不该有的标点符号。  
\#VALUE! 值错误  
vlookup中缺少返回值的参数时，就会出现该错误。  
\#REF!  引用错误  
当函数中所引用的位置不存在时，会导致该错误。例如：引用的单元格、区域被删除  
\#N/A   找不到数据
当查找数据在被查找数据表中一定存在时，单元格格式不一致最可能导致该错误的出现。    

###实现vlookup查找返回多列值：借助match函数  
match 函数：match函数用于查找对象在一组数据中的具体位置，返回一个数值结果。  
match(lookup\_value,lookup\_array,match\_type)  
vlookup+match 完成查找返回多列的功能
在vlookup查找时，根据一个查找条件，查找多列并返回，不需要一个一个写  
vlookup（lookup\_value,table\_array,col\_index\_num,[range\_lookup]）  
col\_index\_num——>自动填写
例如：
vlookup（lookup\_value,table\_array,match(lookup\_value,array,match\_type),[range\_lookup]）  
![vlookup查询返回多列]({{site.baseurl}}/images/vlookup/vlookup多列查询.png)

###实现vlookup函数按多条件查询数据： 借助连接函数 
![vlookup多条件查询]({{site.baseurl}}/images/vlookup/vlookup多查询条件.png)  
例如：通过客户编号和订单编号查询订单金额。   
在查询条件之间连接上“@”，是为了区分似“100”&“01”和“10”&“001”之间的区别，以保证查询结果正确。  
这个公式的思路与用vlookup函数进行逆向查询的私立一样，都是使用IF函数对查询数据进行整理，使其符合vlookup函数的查询需求。  
特别地：写完该函数后需要使用ctrl+shift+enter键，因为该函数为数组函数。  

###实现vlookup反向查询方法1：借助index和match函数
index+match函数组合  
index函数：index函数在给定的区域内，返回第几行第几列的值。
index(array,row\_num,column\_num)  
index+match 完成反查找的功能  
例如：index(array,match(lookup\_value,array,match\_type),column_num)
行和列其实都可以使用match函数进行定位，例子中写的是行按照match函数定位  
![vlookup反向查找]({{site.baseurl}}/images/vlookup/vlookup反向查找1.png)  

###实现vlookup反向查找方法2：  
![vlookup反向查找]({{site.baseurl}}/images/vlookup/vlookup反向查找.png)   
例如：通过学号查找姓名。  
通过if函数完成b1：b4和a1：a4两列数据的位置调换if({true,false},b1:b4,a1:a4)相当于
if(true,b1:b4,a1:a4)
if(false,b1:b4,a1:a4)，
if函数的结果为：b1:b4,a1:a4。
由此，vlookup查找的数据范围变成了b1:b4,a1:a4列，即可完成按照学号完成姓名查找的功能。


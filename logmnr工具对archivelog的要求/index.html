<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.0.0 --> <title>logmnr工具对archivelog的要求 - I’m Amanda</title> <meta property="og:title" content="logmnr工具对archivelog的要求" /> <meta name="description" content="  有个数据库反映某张表中的部分数据丢失，使用logmnr查询定位数据丢失的原因。Logmnr分析归档日志文件，需要归档日志文件还在数据库中没有被清除。但是该数据库每天做增量备份，同时清除归档日志，所以尝试从rman增量备份中的归档直接分析。  发生如下报错：SQL&gt; exec sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new);begin sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new); end;ORA-01284: 文件 /u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1 无法打开ORA-00317: 标头中的文件类型 0 不是日志文件ORA-00334: 归档日志: ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’ORA-06512: 在 “SYS.DBMS_LOGMNR”, line 68ORA-06512: 在 line 1" /> <meta property="og:description" content="  有个数据库反映某张表中的部分数据丢失，使用logmnr查询定位数据丢失的原因。Logmnr分析归档日志文件，需要归档日志文件还在数据库中没有被清除。但是该数据库每天做增量备份，同时清除归档日志，所以尝试从rman增量备份中的归档直接分析。  发生如下报错：SQL&gt; exec sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new);begin sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new); end;ORA-01284: 文件 /u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1 无法打开ORA-00317: 标头中的文件类型 0 不是日志文件ORA-00334: 归档日志: ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’ORA-06512: 在 “SYS.DBMS_LOGMNR”, line 68ORA-06512: 在 line 1" /> <link rel="canonical" href="http://localhost:4000/logmnr%E5%B7%A5%E5%85%B7%E5%AF%B9archivelog%E7%9A%84%E8%A6%81%E6%B1%82/" /> <meta property="og:url" content="http://localhost:4000/logmnr%E5%B7%A5%E5%85%B7%E5%AF%B9archivelog%E7%9A%84%E8%A6%81%E6%B1%82/" /> <meta property="og:site_name" content="I’m Amanda" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-06-25T00:00:00+08:00" /> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BlogPosting", "headline": "logmnr工具对archivelog的要求", "datePublished": "2017-06-25T00:00:00+08:00", "description": "  有个数据库反映某张表中的部分数据丢失，使用logmnr查询定位数据丢失的原因。Logmnr分析归档日志文件，需要归档日志文件还在数据库中没有被清除。但是该数据库每天做增量备份，同时清除归档日志，所以尝试从rman增量备份中的归档直接分析。  发生如下报错：SQL&gt; exec sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new);begin sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new); end;ORA-01284: 文件 /u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1 无法打开ORA-00317: 标头中的文件类型 0 不是日志文件ORA-00334: 归档日志: ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’ORA-06512: 在 “SYS.DBMS_LOGMNR”, line 68ORA-06512: 在 line 1", "url": "http://localhost:4000/logmnr%E5%B7%A5%E5%85%B7%E5%AF%B9archivelog%E7%9A%84%E8%A6%81%E6%B1%82/" } </script> <!-- End Jekyll SEO tag --> <link href="https://fonts.googleapis.com/css?family=Alfa+Slab+One|Source+Serif+Pro" rel="stylesheet"> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://localhost:4000/logmnr%E5%B7%A5%E5%85%B7%E5%AF%B9archivelog%E7%9A%84%E8%A6%81%E6%B1%82/"> <link rel="alternate" type="application/rss+xml" title="I'm Amanda" href="http://localhost:4000/feed.xml"> </head> <body> <div class="wrapper"> <div class="color-bars-header"><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div></div> <style>.color-bars-header{font-size:0}.cor-head{width:12.5%;height:8px;display:inline-block}.colr-1{background-color:#98C1D9}.colr-2{background-color:#F3DE8A}.colr-3{background-color:#A7D3A6}.colr-4{background-color:#EB9486}@media screen and (max-width: 800px){.color-bars-header{margin: 0 -15px}}</style> <header class="site-header"> <div class="wrapper"> <a href="/"><h1 class="site-title">I'm Amanda</h1></a> <nav class="site-nav"> <a href="/" class="nav-link">首页</a> <a href="/category/" class="nav-link">分类</a> <a href="/contact/" class="nav-link">联系</a> </nav> </div> </header> </div> <div class="page-content"> <div class="wrapper"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">logmnr工具对archivelog的要求</h1> <p class="post-meta"><time datetime="2017-06-25T00:00:00+08:00" itemprop="datePublished">Jun 25, 2017</time></p> </header> <div class="post-content" itemprop="articleBody"> <p>  有个数据库反映某张表中的部分数据丢失，使用logmnr查询定位数据丢失的原因。Logmnr分析归档日志文件，需要归档日志文件还在数据库中没有被清除。但是该数据库每天做增量备份，同时清除归档日志，所以尝试从rman增量备份中的归档直接分析。<br />   发生如下报错：<br /> SQL&gt; exec sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new);</p> <p>begin sys.dbms_logmnr.add_logfile(logfilename =&gt; ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’,options =&gt; dbms_logmnr.new); <br /> end;<br /> ORA-01284: 文件 /u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1 无法打开<br /> ORA-00317: 标头中的文件类型 0 不是日志文件<br /> ORA-00334: 归档日志: ‘/u01/databak/rman/level1/201706140100/L1_CJDFWEB_ARCH_20170614_7us6o00l_1_1’ ORA-06512: 在 “SYS.DBMS_LOGMNR”, line 68<br /> ORA-06512: 在 line 1</p> <p>  如此可见：<br /> logmnr在分析日志时，需要保证该日志格式数据库识别。<br /> 为了能还原日志归档，需要在rman备份中恢复备份的归档日志文件。<br /> 恢复到另外路径指定时间段的日志文件：<br /> run {<br /> allocate channel c1 type disk;<br /> SET ARCHIVELOG DESTINATION TO ‘/u01/archivelog/14’;<br /> (指定archivelog恢复的路径，即将rman备份里面的archivelog恢复到哪里) SQL’ALTER SESSION SET NLS_DATE_FORMAT=”YYYY-MM-DD HH24:MI:SS”’;<br /> restore archivelog time between ‘2017-06-14 00:00:00’ and ‘2017-06-14 23:59:59’;<br /> (指定恢复时间) release channel c1;<br /> }</p> <p>  恢复archivelog后，使用logmnr定位表数据丢失的语句及详细信息。具体logmnr使用详见：<a href="https://liuahuo.github.io/logmnr工具的使用">logmnr工具的使用</a></p> </div> </article> <!----> <div id="disqus_thread"></div> <script defer> (function() { var d = document, s = d.createElement('script'); s.src = '//webjeda-demo.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!----> <!--<h2> 分类 </h2> <ul class="category-list"> <li> <a href="/categories/docker"> docker (4) </a> </li> <li> <a href="/categories/linux"> linux (1) </a> </li> <li> <a href="/categories/git"> git (1) </a> </li> <li> <a href="/categories/大数据"> 大数据 (1) </a> </li> <li style="background-color: #444"> <a href="/categories/oracle"> oracle (3) </a> </li> <li> <a href="/categories/数据分析"> 数据分析 (1) </a> </li> <li> <a href="/categories/sql语句"> sql语句 (1) </a> </li> </ul>--> </div> </div> <div class="wrapper"> <footer class="site-footer"> <div class="wrapper"> </div> </footer> <div class="color-bars-header"><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div><div class="cor-head colr-1"></div><div class="cor-head colr-2"></div><div class="cor-head colr-3"></div><div class="cor-head colr-4"></div></div> </div> <!-- Google Analytics Tracking code --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-83979019-1', 'auto'); ga('send', 'pageview'); </script> </body> </html>
